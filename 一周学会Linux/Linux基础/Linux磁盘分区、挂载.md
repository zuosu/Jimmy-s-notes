## Linux分区
### 原理介绍
1)      Linux 来说无论有几个分区，分给哪一目录使用，它归根结底就只有一个根目录，一个独立且唯一的文件结构 , Linux中每个分区都是用来组成整个文件系统的一部分。

2)      Linux 采用了一种叫“载入”的处理方法，它的整个文件系统中包含了一整套的文件和目录，且将一个分区和一个目录联系起来。这时要载入的一个分区将使它的存储空间在一个目录下获得。

3)      示意图

![](https://files.mdnice.com/user/25190/51a93ef7-e82b-44b4-a3d9-df810dc6fd77.png)

### 硬盘说明
1)      Linux 硬盘分 IDE 硬盘和 SCSI 硬盘，目前基本上是 SCSI 硬盘

2)      对于 IDE 硬盘，驱动器标识符为“hdx~”,其中“hd”表明分区所在设备的类型，这里是指 IDE 硬盘了。“x”为盘号（a 为基本盘，b 为基本从属盘，c 为辅助主盘，d 为辅助从属盘）,“~”代表分区，前四个分区用数字 1 到 4 表示，它们是主分区或扩展分区，从 5 开始就是逻辑分区。例，hda3 表示为第一个 IDE 硬盘上的第三个主分区或扩展分区,hdb2 表示为第二个 IDE 硬盘上的第二个主分区或扩展分区。
3)      对于 SCSI 硬盘则标识为“sdx~”，SCSI 硬盘是用“sd”来表示分区所在设备的类型的，其余则和 IDE 硬盘的表示方法一样

![](https://files.mdnice.com/user/25190/f7c1108e-74c0-4001-918a-38ff9335f0a1.png)

### 查找所有设备挂载情况
使用``lsblk``或者``lsblk -f``
![](https://files.mdnice.com/user/25190/ee4f3a1b-9ce6-444a-ac79-b0e82a9bfc5b.png)

![](https://files.mdnice.com/user/25190/9e462eab-98ab-4534-a484-cbf614b06d20.png)

上图中的UUID是唯一标识，mountpoint为挂载点。

## 挂载的经典案例
### 说明
下面我们以增加一块硬盘为例来熟悉下磁盘的相关指令和深入理解磁盘分区、挂载、卸载的概念。

### 如何增加一块硬盘
1) 虚拟机添加硬盘

在【虚拟机】菜单中，选择【设置】，然后设备列表里添加硬盘，然后一路【下一步】，中间只有选择磁盘大小的地方需要修改，至到完成。然后重启系统（才能识别）！

![](https://files.mdnice.com/user/25190/580ed905-5c15-42e6-8f06-9e7f82be39f2.png)

2) 分区

分区命令  ``fdisk /dev/sdb``

开始对/sdb 分区
m      显示命令列表
p 显示磁盘分区 同 fdisk –l n 新增分区
d          删除分区
w      写入并退出

说明： 开始分区后输入 n，新增分区，然后选择 p ，分区类型为主分区。两次回车默认剩余全部空间。最后输入 w

写入分区并退出，若不保存退出输入 q。

![](https://files.mdnice.com/user/25190/ecf7423f-646d-4e42-a763-281682a3c0ad.png)


3. 格式化
 
 格式化磁盘
分区命令:``mkfs -t ext4 /dev/sdb1``，其中 ext4 是分区类型

4. 挂载 

 挂载: 将一个分区与一个目录联系起来，
``mount 设备名称 挂载目录``

例如：`` mount /dev/sdb1 /newdisk``

卸载：
``umount 设备名称 或者 挂载目录``
例如： `` umount /dev/sdb1`` 或者 ``umount /newdisk``
5. 设置可以自动挂载

永久挂载: 通过修改/etc/fstab 实现挂载，添加完成后 执行`` mount –a`` 即刻生效。

## 磁盘情况查询
### 查询系统整体磁盘使用情况
* 基本语法
``df -h``

* 应用实例

查询系统整体磁盘使用情况
![](https://files.mdnice.com/user/25190/0351b806-458a-423c-bf7c-30e96684f072.png)

### 查询指定目录的磁盘占用情况
* 基本语法
``du -h``

查询指定目录的磁盘占用情况，默认为当前目录
-s 指定目录占用大小汇总
-h 带计量单位
-a 含文件
--max-depth=1    子目录深度
-c 列出明细的同时，增加汇总值

* 应用实例

查询 /opt 目录的磁盘占用情况，深度为 1

![](https://files.mdnice.com/user/25190/8e204805-229b-4f11-a44d-fccd4ef3e1cb.png)


## 磁盘情况-工作实用指令
1. 统计/opt 文件夹下文件的个数

``ls -l /opt | grep "^-" | wc -l``

通过管道命令+``grep "^-"``可以筛选出文件，为什么是"^-"？如下图，第一个字符为“-“的代表文件，第一个字符为”d“的代表目录。

![](https://files.mdnice.com/user/25190/63a2ffc5-bc6c-47e1-8d6c-2a586ab51597.png)

筛选之后使用wc计算文件的个数。

2. 统计/opt 文件夹下目录的个数

``ls -l /opt | grep "^d" | wc -l``

``grep "^d"``是筛选的目录。

3. 统计/opt 文件夹下文件的个数，包括子文件夹里的

``ls -lR /opt | grep "^-" | wc -l``
R代表递归

4. 统计/opt 文件夹下目录的个数，包括子文件夹里的

``ls -lR /opt | grep "^d" | wc -l``

5. 以树状显示目录结构 tree 目录 ， 注意，如果没有 tree ,则使用 **yum install tree** 安装
