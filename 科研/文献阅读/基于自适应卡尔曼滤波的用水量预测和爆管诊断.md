# 1. 文章信息
1. 顾建强,刘海星,张朝,赵梦珂,张弛.基于自适应卡尔曼滤波的用水量预测和爆管诊断[J].中国给水排水,**2019**,35(07):62-67.DOI:10.19853/j.zgjsps.1000-4602.2019.07.012.
2. 作者简介: 顾建强( 1994 － ) ，男，河北唐山人，大连理工大学硕士研究生，主要研究方向为给水管网系统优化与 计算。E-mail: 121538934@qq.com
# 2. 背景、目的及结论
## 2.1 背景
1. 目前我国检测爆管事故主要通过地面溢水来判断，根据用户投诉确定事故发生位置，此方式导致爆管事故确认和抢修之前，已经造成 了大量水资源流失，并影响了周围环境和城市的正常运行。
2. 基于经验的人工检测方法会耗费大量人力物力，**因此需要开发新的爆管预警方法，以提高突发事故的应对能力，爆管预警方法应具有经济性、安全性和高效性**。
3. **国内：** 任永昌等采用流量平衡法建立检测模型，通过对模型的分析来进行爆管检测，其条件要求比较高，建模的信息必须完全准确，并且流量监测点数据必须充足，而这在现实中往往难以达到。
4. 曹梅花[5]根据爆管特征值的变化来分析爆管事件，但其管网模拟的精度有待提高，缺乏准确的节点流量计算方法。
5. 孟潇［6］运用供水系统的历史资料，建立事故工况下的管网宏观模型，以此来实时监测管网运行，此方法对爆管事故判断不及时。
6. 李诚等［7］基于CUSUM算法，利用观测值与目标值偏差的积累对给水管网诊断进行分析，其诊断结果与历史数据密切相关，因此可能存在一定程度的误报。
7. **国外：** Mounce等[8]使用人工神经网络方法，处理供水管网中流量和水压数据，通过预测这些水力参数的概率分布函数，诊断长时间序列数据中的爆管事件，但算法需要长序列的数据训练才能达到稳定收敛，并且需要定期更新，对历史数据要求高。
8. Misiunas等[9]根据爆管时产生的瞬态压力波来进行爆管检测分析，其基于高频压力信号进行计算分析，实际效用较差。
## 2.2 目的
笔者提出了基于实测流量数据的智能分析方 法，应用自适应卡尔曼滤波算法［10］来判断流量信号中的异常增大情况，进而推测爆管事件的发生。与上述方法相比，**该方法具有计算速度快、效率高、预警及时，并且无需大量数据进行训练等优点**。

# 3. 正文笔记
## 3.1 卡尔曼滤波的模型
* 系统的动态方程
将第k-1步和第k步的状态量之间的差异看作是符合高斯分布的噪声，在卡尔曼滤波第k步时，在已知高斯白噪声Q的前提下，流量的状态量$x$可通过线性差分方程来表示：
$$
x(k) = x(k-1)+Q\tag{1}
$$
* 观测方程
考虑到流量计和数据上传的误差，将由设备造成的不确定性看作符合高斯分布的噪声R，流量的观测量$z$可通过下述方程表示：
$$
z(k) = x(k)+R\tag{2}
$$
在第k步时，将公式(1)中的状态预测量记为$x(k|k-1)$，将滤波器的估计值记为$x(k|k),q(k)$和$r(k)$是Q和R的协方差，滤波器进行流量预测时按照以下五个步骤进行：
(1) 预估流量值  
$$x(k \mid k-1)=x(k-1 \mid k-1)\tag{3}$$
(2) 预估流量协方差
$$p(k \mid k-1)=p(k-1 \mid k-1)+q(k)\tag{4}$$
(3) 计算卡尔曼增益  K 
$$K=p(k \mid k-1)[p(k \mid k-1)+r(k)]^{-1}\tag{5}$$
(4) 更新流量预测值
$$x(k \mid k)=  x(k \mid k-1)+K[z(k)-x(k \mid k-1)]\tag{6}$$
(5) 更新流量协方差
$$
p(k \mid k)=(1-K) p(k \mid k-1)\tag{7}
$$
**本试验采用自适应卡尔曼滤波器，其能根据滤波过程和观测值的合理权重自动调节参数，从而改进滤波设计、缩小实际误差以确定无偏估计**。此种 滤波方法将系统辨识与滤波估计有效地结为一体。
> 关于“自适应调节参数”，文章中没有做具体阐述

由于随时间变化的流量数据波动较大，因此在时间序列上的流量数据无 法计算其均值和方差，因此卡尔曼滤波器很难在随时间演进的维度上得到合理的预测值。然而不同日同一时刻的流量值比较相近，理论上数值变化幅度较小，更符合卡尔曼滤波预测的原理，所以**将不同日同一时刻的数据作为输入滤波器的实测值**。

## 3.2 试验数据获取与处理
采集大连理工大学生活区的流量，提取2013 年10 月—2014 年 8 月的数据作为基础数据， 进行了为期1 年的正常流量预测试验。
节能监管平台中的数据是**以小时为采样频率的水量数据**，而本次研究需要的是更小频率下的流量数据，将数据由 $m^3/h$换算成$L/s$，并**通过线性插值**的方式将该数据的采集频率缩小为15 min[14]。
## 3.3 结果与分析
以一天为研究对象，每个时刻（15min）单独建立滤波器，共有96（24*60/15）个滤波器。滤波器的个数取决于采样频率，采样频率越高，滤波器的个数越多。

1. 预测曲线可以随实测曲线的趋势而变化，并且预测曲线始终在实测曲线的中间位置波动，预测值不会随观测值的剧烈变化而大幅波动，即滤波器可以预测出比较准确的流量均值。
2. 因为滤波器预测的是不同天的同一时刻，当预测曲线出现异常波动并不能说明在这一天的时候出现漏损，因为在这一天的第k+1时刻的数据并不一定异常。**每个滤波 器都是独立且互不影响，最后是依据多个时刻连续变化的流量数据异常判断管网是否发生爆管事故**。
3. 将预测的流量数据**以时间轴和流量为参照系进行展示**，选取典型日的流量变化曲线进行分析，计算预测值与真实值之间的偏差，当偏差超过一定值时认为出现漏损。
4. **用水规律差异**（如工作日和节假日用水规律不同）**引起的偏差过大会造成漏损检测的误判**。为此，作者提出将节假日与工作日的数据进行分类，并分别对节假日与工作日建立模型，对日用水规律不同的日期分开进行预测，此方法可以提高流量预测的准确性。
5. 论文中还提出了因为突发性用水事件导致的偏差过大也会引起误判，最后说明**应结合实际的事故记录及特定的用水事件，对滤波器的检测结果进行分析评估，以提高滤波器诊断爆管的成功率，防止发生误报。**
> 文中用了96个滤波器，且每个滤波器都是独立的。
> 虽然每个滤波器之间的预测是独立的，但是用水量是连续的，下一时刻的用水量与上一时刻用水量应该是存在联系的，所以能将这些滤波器融合吗？怎么融合？
# 4. 结果与讨论
1. 卡尔曼滤波器的预测曲线可以随实测曲线的趋势而变化，并且预测曲线始终在实测曲线的均 值上下波动，滤波器可以有效排除噪声( 流量波动 和设备误差等) 的干扰，预测出一个比较准确的流 量正常值。
2. 单独的数据点异常不能成为判断爆管事件的标准，持续长时间的流量数据异常才可以推断爆管事故的发生，因此较高频率的流量数据收集及传 输，可以提高诊断工作的效率，同时也要顾及流量监 测点的电耗等方面的可操作性问题
3. 在学校生活区节假日和工作日用水规律有明显差异，将不同用水规律的流量数据( 以日为研 究对象) 分类，分别建立预测模型，可以提高预测模 型的准确性，对辨识爆管事故产生有益的影响。
4. 除了爆管事故可以被检测出以外，突发性的用水活动也会干扰滤波器诊断效率，因此在实际诊断工作中，最好协同多部门( 如热线服务系统) 工作，以提高爆管预测预警的准确率。
# 5. 文章好在哪里（1个思路、2个绘图、5个句式）
使用卡尔曼滤波不需要大量的历史数据作为支撑。

